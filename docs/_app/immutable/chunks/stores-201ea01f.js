import{w as l}from"./index-2c9e022f.js";import{Y as n}from"./index-b2b37e39.js";let f=(t,e)=>{};const v=()=>{f=(t,e)=>{if(!localStorage)return;const s=u=>JSON.stringify(u,null,2);localStorage.getItem(t)===null&&localStorage.setItem(t,s(e));const r=JSON.parse(localStorage.getItem(t)),{subscribe:a,set:i,update:h}=l(r);return{subscribe:a,set:u=>(localStorage.setItem(t,s(u)),i(u)),update:h}}};let d=null;const S=()=>{try{d=f("dark",k()),d.subscribe(t=>{localStorage.setItem("dark",JSON.stringify(t)),p(t)})}catch(t){console.error("initDark",t)}},x=()=>{d.update(t=>!t)},y=()=>n(d);let c=l(null);const J=()=>n(c),N=t=>c.set(t);let w=l(null);const m=t=>w.set(t),k=()=>{try{return window&&window.matchMedia("(prefers-color-scheme: dark)").matches}catch{return!1}},p=t=>{if(!document)return;let e=document.documentElement.attributes["data-theme"];e.value=t?"dark":"light"};let _=l(null);const D=()=>{v(),_=f("settings",{external_program:{exec_server_url:"http://localhost:9000/exec",program:"runstreamlink.sh"},twitch_proxy_api:{url:"http://localhost:9000/api/twitch"},max_recent_videos:50}),S(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{x(),p(y())}),c.set(JSON.parse(localStorage.getItem("user"))),c.subscribe(e=>{localStorage.user=JSON.stringify(e)})},o=async t=>{const e=n(_);return e||D(),await(await fetch(`${e.twitch_proxy_api.url}?url=${encodeURIComponent(t)}`)).json()},O=async t=>{let s=(await o(`https://api.twitch.tv/helix/users?login=${t}`)).data[0];return m(await g(s.id)),s},g=async t=>{const e=await o(`https://api.twitch.tv/helix/users/follows?first=100&from_id=${t}`);let s="";for(let a=0;a<e.data.length;++a){let i=e.data[a];s+=(a==0?"id=":"&id=")+i.to_id}const r=await o(`https://api.twitch.tv/helix/users?${s}`);for(let a=0;a<e.data.length;++a){let i=e.data[a];e.data[a].user=r.data.find(h=>h.id==i.to_id)}return e},U=async(t,e)=>await o(`https://api.twitch.tv/helix/videos?first=100&user_id=${t}&type=${e}`);let q=l(null),L=l(0);const $=async t=>await o(`https://api.twitch.tv/helix/streams?first=100&${t}`),T=async t=>{const e=navigator.languages[0].substring(0,2);return await o(`https://api.twitch.tv/helix/streams?first=100&game_id=${t}&language=${e}`)},V=async t=>{let e="";const s=n(c);n(w)===null&&s&&s.id&&m(await g(s.id));let r=s&&s.id===t?n(w):await g(t);for(let a=0;a<r.data.length;++a){let i=r.data[a];e+=(a==0?"user_id=":"&user_id=")+i.to_id}return await $(e)};let j=["most recent","least recent","most viewers","least viewers"],C=[(t,e)=>new Date(e.started_at)-new Date(t.started_at),(t,e)=>new Date(t.started_at)-new Date(e.started_at),(t,e)=>e.viewer_count-t.viewer_count,(t,e)=>t.viewer_count-e.viewer_count];const E=(t,e)=>(t.data.sort((s,r)=>e(s,r)),t),F=async t=>await o("https://api.twitch.tv/helix/games/top?first=100"),M=async t=>t?await o(`https://api.twitch.tv/helix/search/categories?first=100&query=${t}`):null;export{D as a,g as b,_ as c,j as d,o as e,O as f,y as g,M as h,E as i,C as j,T as k,V as l,F as m,J as n,w as o,m as p,L as q,q as r,N as s,x as t,c as u,U as v};
