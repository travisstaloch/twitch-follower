import{S as j,i as z,s as A,l as V,g as m,n as W,o as b,p as X,q as g,d as c,T as $,v as Y,a8 as M,w as D,x as I,y as N,B as T,e as p,t as O,k as R,c as h,a as v,h as P,m as y,b as k,H as x,E as q,I as Z}from"../chunks/index-b2b37e39.js";import{r as U,p as ee,v as S,u as te,c as se,q as le,b as oe,e as re}from"../chunks/stores-8c6b68ba.js";import{r as ie,i as ne,n as ae}from"../chunks/util-2ac49776.js";import{R as ce}from"../chunks/Refresh-e04be643.js";import{V as fe}from"../chunks/Videos-b50f39ef.js";import"../chunks/index-2c9e022f.js";import"../chunks/stores-b9e3c672.js";function ue(a){let e,l;return e=new fe({props:{videos:a[0],uname:null,showEachVideoUname:!0,title:"Recent Videos",$$slots:{default:[me]},$$scope:{ctx:a}}}),{c(){D(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,r){N(e,s,r),l=!0},p(s,r){const i={};r&1&&(i.videos=s[0]),r&514&&(i.$$scope={dirty:r,ctx:s}),e.$set(i)},i(s){l||(g(e.$$.fragment,s),l=!0)},o(s){b(e.$$.fragment,s),l=!1},d(s){T(e,s)}}}function _e(a){let e,l,s,r,i,n,f;return{c(){e=p("h1"),l=O("Recent Videos"),s=R(),r=p("div"),i=O("Fetching..."),n=R(),f=p("progress"),this.h()},l(t){e=h(t,"H1",{});var o=v(e);l=P(o,"Recent Videos"),o.forEach(c),s=y(t),r=h(t,"DIV",{class:!0});var u=v(r);i=P(u,"Fetching..."),u.forEach(c),n=y(t),f=h(t,"PROGRESS",{class:!0}),v(f).forEach(c),this.h()},h(){k(r,"class","align-center"),f.value=a[1],k(f,"class","svelte-oml5ul")},m(t,o){m(t,e,o),x(e,l),m(t,s,o),m(t,r,o),x(r,i),m(t,n,o),m(t,f,o)},p(t,o){o&2&&(f.value=t[1])},i:q,o:q,d(t){t&&c(e),t&&c(s),t&&c(r),t&&c(n),t&&c(f)}}}function J(a){let e,l,s,r;return{c(){e=p("div"),l=O("Fetching..."),s=R(),r=p("progress"),this.h()},l(i){e=h(i,"DIV",{class:!0});var n=v(e);l=P(n,"Fetching..."),n.forEach(c),s=y(i),r=h(i,"PROGRESS",{class:!0}),v(r).forEach(c),this.h()},h(){k(e,"class","align-center"),r.value=a[1],k(r,"class","svelte-oml5ul")},m(i,n){m(i,e,n),x(e,l),m(i,s,n),m(i,r,n)},p(i,n){n&2&&(r.value=i[1])},d(i){i&&c(e),i&&c(s),i&&c(r)}}}function me(a){let e,l,s,r,i,n,f;l=new ce({});let t=a[1]<1&&J(a);return{c(){e=p("button"),D(l.$$.fragment),s=R(),t&&t.c(),r=V(),this.h()},l(o){e=h(o,"BUTTON",{title:!0});var u=v(e);I(l.$$.fragment,u),u.forEach(c),s=y(o),t&&t.l(o),r=V(),this.h()},h(){k(e,"title","refresh")},m(o,u){m(o,e,u),N(l,e,null),m(o,s,u),t&&t.m(o,u),m(o,r,u),i=!0,n||(f=Z(e,"click",a[3]),n=!0)},p(o,u){o[1]<1?t?t.p(o,u):(t=J(o),t.c(),t.m(r.parentNode,r)):t&&(t.d(1),t=null)},i(o){i||(g(l.$$.fragment,o),i=!0)},o(o){b(l.$$.fragment,o),i=!1},d(o){o&&c(e),T(l),o&&c(s),t&&t.d(o),o&&c(r),n=!1,f()}}}function de(a){let e,l,s,r;const i=[_e,ue],n=[];function f(t,o){return t[0]===null?0:1}return e=f(a),l=n[e]=i[e](a),{c(){l.c(),s=V()},l(t){l.l(t),s=V()},m(t,o){n[e].m(t,o),m(t,s,o),r=!0},p(t,[o]){let u=e;e=f(t),e===u?n[e].p(t,o):(W(),b(n[u],1,1,()=>{n[u]=null}),X(),l=n[e],l?l.p(t,o):(l=n[e]=i[e](t),l.c()),g(l,1),l.m(s.parentNode,s))},i(t){r||(g(l),r=!0)},o(t){b(l),r=!1},d(t){n[e].d(t),t&&c(s)}}}function pe(a,e,l){let s,r,i,n,f;$(a,U,_=>l(0,s=_)),$(a,ee,_=>l(4,r=_)),$(a,S,_=>l(1,i=_)),$(a,te,_=>l(5,n=_)),$(a,se,_=>l(6,f=_));async function t(){r.data.length;let _=r,d=[];const B=f.max_recent_videos;Math.floor(_.data.length/ie);let C=0;for(const K of _.data){const L=K.to_id;let Q=await re(`https://api.twitch.tv/helix/videos?first=4&user_id=${L}&type=archive`);for(const w of Q.data){let E=new Date(w.created_at),F=ne({date:E,video:w},d,(G,H)=>ae(H.date?H.date.valueOf():0,G.date?G.date.valueOf():0));d.length<B?d.splice(F+1,0,{date:E,video:w}):F<B&&(d.pop(),d.splice(F+1,0,{date:E,video:w}))}C+=1,M(S,i=C/r.data.length,i)}return d}async function o(){r===null&&le(await oe(n.id)),M(S,i=0,i);const _=await t();U.set({data:_.map(d=>d.video)})}return Y(async()=>{s===null&&o()}),[s,i,o,()=>{o()}]}class he extends j{constructor(e){super(),z(this,e,pe,de,A,{})}}function ve(a){let e,l;return e=new he({}),{c(){D(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,r){N(e,s,r),l=!0},p:q,i(s){l||(g(e.$$.fragment,s),l=!0)},o(s){b(e.$$.fragment,s),l=!1},d(s){T(e,s)}}}class ye extends j{constructor(e){super(),z(this,e,null,ve,A,{})}}export{ye as default};
