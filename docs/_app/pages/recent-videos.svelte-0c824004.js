import{S as T,i as W,s as x,l as S,g as p,n as N,o as _,p as U,q as d,d as f,U as h,v as q,D as B,w as V,x as w,y as R,B as E,e as g,t as F,k as M,c as $,a as v,h as O,m as I,b,H as P,K as y,I as D}from"../chunks/vendor-611aba13.js";import{r as k,c as H,u as L,d as G,e as K}from"../chunks/stores-dbe2d455.js";import{r as j}from"../chunks/util-b72d8139.js";import{R as z}from"../chunks/Refresh-58a37abd.js";import{V as A}from"../chunks/Videos-d8590486.js";import"../chunks/stores-76a0209b.js";function J(i){let e,r;return e=new A({props:{videos:i[0],uname:null,showEachVideoUname:!0,title:"Recent Videos",$$slots:{default:[X]},$$scope:{ctx:i}}}),{c(){V(e.$$.fragment)},l(t){w(e.$$.fragment,t)},m(t,o){R(e,t,o),r=!0},p(t,o){const u={};o&1&&(u.videos=t[0]),o&128&&(u.$$scope={dirty:o,ctx:t}),e.$set(u)},i(t){r||(d(e.$$.fragment,t),r=!0)},o(t){_(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}function Q(i){let e,r,t,o,u,n,a;return{c(){e=g("h1"),r=F("Recent Videos"),t=M(),o=g("div"),u=F("Fetching..."),n=M(),a=g("progress"),this.h()},l(s){e=$(s,"H1",{});var l=v(e);r=O(l,"Recent Videos"),l.forEach(f),t=I(s),o=$(s,"DIV",{class:!0});var c=v(o);u=O(c,"Fetching..."),c.forEach(f),n=I(s),a=$(s,"PROGRESS",{class:!0}),v(a).forEach(f),this.h()},h(){b(o,"class","align-center"),a.value=i[1],b(a,"class","svelte-108rn9f")},m(s,l){p(s,e,l),P(e,r),p(s,t,l),p(s,o,l),P(o,u),p(s,n,l),p(s,a,l)},p(s,l){l&2&&(a.value=s[1])},i:y,o:y,d(s){s&&f(e),s&&f(t),s&&f(o),s&&f(n),s&&f(a)}}}function X(i){let e,r,t,o,u;return r=new z({}),{c(){e=g("button"),V(r.$$.fragment),this.h()},l(n){e=$(n,"BUTTON",{title:!0});var a=v(e);w(r.$$.fragment,a),a.forEach(f),this.h()},h(){b(e,"title","refresh")},m(n,a){p(n,e,a),R(r,e,null),t=!0,o||(u=D(e,"click",i[4]),o=!0)},p:y,i(n){t||(d(r.$$.fragment,n),t=!0)},o(n){_(r.$$.fragment,n),t=!1},d(n){n&&f(e),E(r),o=!1,u()}}}function Y(i){let e,r,t,o;const u=[Q,J],n=[];function a(s,l){return s[0]==null?0:1}return e=a(i),r=n[e]=u[e](i),{c(){r.c(),t=S()},l(s){r.l(s),t=S()},m(s,l){n[e].m(s,l),p(s,t,l),o=!0},p(s,[l]){let c=e;e=a(s),e===c?n[e].p(s,l):(N(),_(n[c],1,1,()=>{n[c]=null}),U(),r=n[e],r?r.p(s,l):(r=n[e]=u[e](s),r.c()),d(r,1),r.m(t.parentNode,t))},i(s){o||(d(r),o=!0)},o(s){_(r),o=!1},d(s){n[e].d(s),s&&f(t)}}}function Z(i,e,r){let t,o,u,n;h(i,k,c=>r(0,t=c)),h(i,H,c=>r(5,o=c)),h(i,L,c=>r(6,u=c));const a=B(0);h(i,a,c=>r(1,n=c));const s=async()=>{const c=new MessageChannel;navigator.serviceWorker.controller.postMessage({type:"INIT_PORT"},[c.port2]),c.port1.onmessage=m=>{m.data.type=="recentVideos"?k.set({data:m.data.payload.map(C=>C.video)}):m.data.type=="recentVideosProgress"?a.set(m.data.payload/j):console.error("data.type not handled: ",m.data.type,m.data.payload)},o===null&&G(await K(u.id)),navigator.serviceWorker.controller.postMessage({type:"FOLLOWS",payload:o})};return q(async()=>{t==null&&await s()}),[t,n,a,s,()=>{k.set(null),s()}]}class ee extends T{constructor(e){super();W(this,e,Z,Y,x,{})}}function te(i){let e,r;return e=new ee({}),{c(){V(e.$$.fragment)},l(t){w(e.$$.fragment,t)},m(t,o){R(e,t,o),r=!0},p:y,i(t){r||(d(e.$$.fragment,t),r=!0)},o(t){_(e.$$.fragment,t),r=!1},d(t){E(e,t)}}}class ie extends T{constructor(e){super();W(this,e,null,te,x,{})}}export{ie as default};
